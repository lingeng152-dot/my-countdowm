<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Á∫™ÂøµÊó•Âä©Êâã</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root { --primary: #6c5ce7; --danger: #ff7675; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f4f7f6; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .input-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 400px; display: grid; gap: 10px; margin-bottom: 20px; }
        input { padding: 12px; border: 1px solid #eee; border-radius: 10px; font-size: 16px; outline: none; }
        button#add-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 16px; }
        #list { width: 100%; max-width: 400px; }
        .card { background: white; margin-bottom: 15px; padding: 18px; border-radius: 16px; position: relative; border-left: 6px solid var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .card.urgent { border-left-color: var(--danger); animation: breathe 2s infinite; }
        @keyframes breathe { 50% { background: #fff5f5; } }
        .title { font-weight: bold; font-size: 1.1rem; color: #2d3436; margin-bottom: 5px; }
        .time { font-family: "Courier New", monospace; color: #636e72; font-size: 1rem; }
        .del { position: absolute; right: 15px; top: 15px; background: #f1f2f6; border: none; width: 24px; height: 24px; border-radius: 50%; color: #b2bec3; cursor: pointer; }
    </style>
</head>
<body>
    <div class="input-card">
        <input type="text" id="t" placeholder="‰æãÂ¶ÇÔºöÊàëÁöÑÁîüÊó•">
        <input type="date" id="d">
        <button id="add-btn">‰øùÂ≠òÁ∫™ÂøµÊó•</button>
    </div>
    <div id="list"></div>

    <script>
        let evs = JSON.parse(localStorage.getItem('evs')) || [];
        const render = () => {
            const container = document.getElementById('list');
            container.innerHTML = evs.length ? '' : '<p style="text-align:center;color:#999;margin-top:20px;">ÁÇπÂáª‰∏äÊñπÊ∑ªÂä†‰Ω†ÁöÑÁ¨¨‰∏Ä‰∏™Á∫™ÂøµÊó• ‚ú®</p >';
            evs.sort((a,b) => new Date(a.d) - new Date(b.d)).forEach(e => {
                const diff = new Date(e.d) - new Date();
                const isUrgent = diff > 0 && diff < 259200000; // Â∞ë‰∫é3Â§©ÂèòËâ≤
                const div = document.createElement('div');
                div.className = `card ${isUrgent ? 'urgent' : ''}`;
                div.innerHTML = `<button class="del" onclick="del(${e.id})">‚úï</button>
                    <div class="title">${e.t}</div><div class="time">${fmt(diff)}</div>`;
                container.appendChild(div);
            });
        };
        const fmt = (ms) => {
            if (ms <= 0) return "üéâ ÁõÆÊ†áÊó•Â≠êÂ∑≤Âà∞ËææÔºÅ";
            const d = Math.floor(ms/86400000), h = Math.floor((ms/3600000)%24), m = Math.floor((ms/60000)%60), s = Math.floor((ms/1000)%60);
            return `${d}Â§© ${h}Êó∂ ${m}ÂàÜ ${s}Áßí`;
        };
        window.del = (id) => { evs = evs.filter(x => x.id !== id); save(); };
        const save = () => { localStorage.setItem('evs', JSON.stringify(evs)); render(); };
        document.getElementById('add-btn').onclick = () => {
            const t = document.getElementById('t').value, d = document.getElementById('d').value;
            if (t && d) { evs.push({id: Date.now(), t, d}); save(); document.getElementById('t').value = ''; }
        };
        setInterval(render, 1000); render();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('PWA Ready'));
            });
        }
    </script>
</body>
</html>
